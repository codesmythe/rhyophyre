0001   0000             ;__T7220_______________________________________________________________________________________________________________________
0002   0000             ;
0003   0000             ;		TEST 7220 0PROGRAM
0004   0000             ;		AUTHOR: DAN WERNER -- 7/24/2010
0005   0000             ;________________________________________________________________________________________________________________________________
0006   0000             ;
0007   0000             
0008   0000             ; DATA CONSTANTS
0009   0000             ;________________________________________________________________________________________________________________________________
0010   0000             ;REGISTER		IO PORT			; FUNCTION
0011   0000             gdc_status: 	       	.EQU	090H
0012   0000             gdc_command: 		.EQU	091H
0013   0000             gdc_param: 		.EQU	090H
0014   0000             gdc_read: 		.EQU	091H
0015   0000             ramdac_latch: 		.EQU	094H
0016   0000             ramdac_base: 		.EQU	098H
0017   0000             
0018   0000             ramdac_address_wr:	.EQU (ramdac_base+0)
0019   0000             ramdac_address_rd:	.EQU (ramdac_base+3)
0020   0000             ramdac_palette_ram:	.EQU (ramdac_base+1)
0021   0000             ramdac_pixel_read_mask:	.EQU (ramdac_base+2)
0022   0000             
0023   0000             ramdac_overlay_wr:	.EQU (ramdac_base+4)
0024   0000             ramdac_overlay_rd:	.EQU (ramdac_base+7)
0025   0000             ramdac_overlay_ram:	.EQU (ramdac_base+5)
0026   0000             ramdac_do_not_use:	.EQU  (ramdac_base+6)
0027   0000             
0028   0000             
0029   0000             BS:			.EQU    008H		; ASCII backspace character
0030   0000             CR:			.EQU    00DH		; CARRIAGE RETURN CHARACTER
0031   0000             LF:			.EQU	00AH		; LINE FEED CHARACTER
0032   0000             END:			.EQU	'$' 		; LINE TERMINATOR FOR CP/M STRINGS
0033   0000             
0034   0000             ; Latch bits
0035   0000             LATCH_RAMDAC_256:	.EQU	80H		; 256 color mode
0036   0000             LATCH_OVERLAY_MASK:	.EQU    0FH     	; 4 overlay bits
0037   0000             
0038   0000             ;
0039   0000             ; commands:
0040   0000             ;
0041   0000             RESET			.EQU	000H
0042   0000             SYNC	 		.EQU	00EH
0043   0000             VSYNC  			.EQU	06FH
0044   0000             CCHAR  			.EQU	04BH
0045   0000             START			.EQU	06BH
0046   0000             ZOOM   			.EQU	046H
0047   0000             CURS	 		.EQU	049H
0048   0000             PRAM   			.EQU	070H
0049   0000             PITCH	 		.EQU	047H
0050   0000             
0051   0000             
0052   0000             ; Drawing modes:
0053   0000             GDC_REPLACE	.EQU		0
0054   0000             GDC_XOR		.EQU		1
0055   0000             GDC_OR		.EQU		3
0056   0000             GDC_CLEAR	.EQU		2
0057   0000             
0058   0000             
0059   0000             
0060   0000             ;________________________________________________________________________________________________________________________________
0061   0000             ; MAIN PROGRAM BEGINS HERE
0062   0000             ;________________________________________________________________________________________________________________________________
0063   0100             	.ORG	$0100
0064   0100             
0065   0100 11 C6 03    	LD	DE,MSG_START	;
0066   0103 0E 09       	LD	C,09H		;
0067   0105 CD 05 00    	CALL	0005H 		;
0068   0108             
0069   0108 CD 8B 01    	CALL	ramdac_init	;
0070   010B 3E 00       	LD 	A,0		;
0071   010D CD D9 01    	CALL 	ramdac_set_read_mask	;    ramdac_set_read_mask(0x0F)
0072   0110 3E 00       	LD	A,0
0073   0112 CD DC 01    	CALL 	ramdac_overlay	;   ramdac_overlay(0)
0074   0115             
0075   0115 3E 01       	LD	A,1
0076   0117 CD 01 02    	CALL	gdc_init	;
0077   011A             
0078   011A 11 FC 03    	LD	DE,MSG_INIT	;
0079   011D 0E 09       	LD	C,09H		; CP/M WRITE END STRING TO CONSOLE CALL
0080   011F CD 05 00    	CALL	0005H 		;
0081   0122             
0082   0122 11 14 04    	LD	DE,MSG_GCHAR	;
0083   0125 0E 09       	LD	C,09H		; CP/M WRITE END STRING TO CONSOLE CALL
0084   0127 CD 05 00    	CALL	0005H 		;
0085   012A             
0086   012A CD 0D 03        	CALL 	gchar_test	;
0087   012D             
0088   012D             
0089   012D             ;	CALL	INIT7220	;
0090   012D             
0091   012D 11 E2 03    	LD	DE,MSG_END	;
0092   0130 0E 09       	LD	C,09H		; CP/M WRITE END STRING TO CONSOLE CALL
0093   0132 CD 05 00    	CALL	0005H 		;
0094   0135             
0095   0135 0E 00       	LD	C,00H		; CP/M SYSTEM RESET CALL
0096   0137 CD 05 00    	CALL	0005H 		; RETURN TO PROMPT
0097   013A             
0098   013A             ;SYNCP: 	.DB		012H,026H,045H,000H,002H,00AH,0E0H,085H
0099   013A 12 26 44 04 SYNCP: 	.DB	012H,026H,044H,004H,002H,00AH,0E0H,085H  ;;VERIFY THESE NUMBERS
0099   013E 02 0A E0 85 
0100   0142 00 00 00    CCHARP:	.DB	000H,000H,000H
0101   0145 28          PITCHP:	.DB	028H   ;;VERIFY THESE NUMBERS
0102   0146 00 00 00 E0 PRAMP:	.DB	000H,000H,000H,0E0H,001H,000H,000H
0102   014A 01 00 00 
0103   014D 00          ZOOMP:	.DB	000H   VERIFY THESE NUMBERS
0104   014E 00 00 00    CURSP:	.DB	000H,000H,000H
0105   0151 FF FF       PATTERN:	.DW	0FFFFH
0106   0153             
0107   0153 FF 9F 87 8B CHPATTERN: .DB	0ffH, 09fH, 087H, 08bH,093H, 0a3H, 083H, 0ffH
0107   0157 93 A3 83 FF 
0108   015B             
0109   015B             
0110   015B             default_palette:
0111   015B 00 00 00    	.DB	0,   0,   0
0112   015E 00 00 80    	.DB	0,   0, 128
0113   0161 00 80 00    	.DB	0, 128,   0
0114   0164 00 80 80    	.DB	0, 128, 128
0115   0167 80 00 00    	.DB	128,   0,   0
0116   016A 80 00 80    	.DB	128,   0, 128
0117   016D 80 40 00    	.DB	128,  64,   0
0118   0170 80 80 80    	.DB	128, 128, 128
0119   0173 40 40 40    	.DB	64,  64,  64
0120   0176 00 00 FF    	.DB	 0,   0, 255
0121   0179 00 FF 00    	.DB	 0, 255,   0
0122   017C 00 FF FF    	.DB	 0, 255, 255
0123   017F FF 00 00    	.DB	255,   0,   0
0124   0182 FF 00 FF    	.DB	255,   0, 255
0125   0185 FF FF 00    	.DB	255, 255,   0
0126   0188 FF FF FF    	.DB	255, 255, 255
0127   018B             
0128   018B             
0129   018B             ramdac_init:
0130   018B 3E 00       	LD	A,0		;   ramdac_overlay(0)
0131   018D CD DC 01    	CALL 	ramdac_overlay
0132   0190             
0133   0190 3E 01       	LD 	A,1
0134   0192 DD 21 5E 01 	LD 	IX,default_palette+3
0135   0196             ramdac_init_a:
0136   0196             	; parameter (overlay, Red,Green,Blue) in C,H,L,B
0137   0196 4F          	LD 	C,A
0138   0197 DD 66 00    	LD 	H,(IX)
0139   019A DD 23       	INC 	IX
0140   019C DD 6E 00    	LD 	L,(IX)
0141   019F DD 23       	INC 	IX
0142   01A1 DD 46 00    	LD 	B,(IX)
0143   01A4 DD 23       	INC 	IX
0144   01A6 CD E3 01    	CALL 	ramdac_set_overlay_color
0145   01A9 3C          	INC 	A
0146   01AA FE 10       	CP 	16
0147   01AC C2 96 01    	JP 	NZ,ramdac_init_a
0148   01AF             
0149   01AF 3E 08       	LD	A,8		;   ramdac_overlay(8)
0150   01B1 CD DC 01    	CALL 	ramdac_overlay
0151   01B4 3E 0F          	LD	A,0FH		;   ramdac_set_read_mask(0x0F);
0152   01B6 CD D9 01    	CALL	ramdac_set_read_mask
0153   01B9             
0154   01B9 3E 00       	LD 	A,0
0155   01BB DD 21 5B 01 	LD 	IX,default_palette
0156   01BF             ramdac_init_b:
0157   01BF             	; parameter (index, Red,Green,Blue) in C,H,L,B
0158   01BF 4F          	LD 	C,A
0159   01C0 DD 66 00    	LD 	H,(IX)
0160   01C3 DD 23       	INC 	IX
0161   01C5 DD 6E 00    	LD 	L,(IX)
0162   01C8 DD 23       	INC 	IX
0163   01CA DD 46 00    	LD 	B,(IX)
0164   01CD DD 23       	INC 	IX
0165   01CF CD F2 01    	CALL 	ramdac_set_palette_color
0166   01D2 3C          	INC 	A
0167   01D3 FE 10       	CP 	16
0168   01D5 C2 BF 01    	JP 	NZ,ramdac_init_b
0169   01D8             
0170   01D8 C9          	RET
0171   01D9             
0172   01D9             ; parameter(mask) in A
0173   01D9             ramdac_set_read_mask:
0174   01D9 D3 9A       	OUT	(ramdac_pixel_read_mask),A
0175   01DB C9          	RET
0176   01DC             
0177   01DC             ; parameter(overlay) in A
0178   01DC             ramdac_overlay:
0179   01DC E6 0F       	AND 	LATCH_OVERLAY_MASK
0180   01DE F6 80       	OR 	LATCH_RAMDAC_256
0181   01E0 D3 94       	OUT	(ramdac_latch),A	; Set Ramdac latch
0182   01E2 C9          	RET
0183   01E3             
0184   01E3             ; parameter (overlay, Red,Green,Blue) in C,H,L,B
0185   01E3             ramdac_set_overlay_color:
0186   01E3 F5          	PUSH	AF		; STORE REGISTERS
0187   01E4 79          	LD 	A,C
0188   01E5 D3 9C       	OUT	(ramdac_overlay_wr),A
0189   01E7 7C          	LD 	A,H
0190   01E8 D3 9D       	OUT	(ramdac_overlay_ram),A
0191   01EA 7D          	LD 	A,L
0192   01EB D3 9D       	OUT	(ramdac_overlay_ram),A
0193   01ED 78          	LD 	A,B
0194   01EE D3 9D       	OUT	(ramdac_overlay_ram),A
0195   01F0 F1          	POP	AF		; RESTORE
0196   01F1 C9          	RET
0197   01F2             
0198   01F2             ; parameter (index, Red,Green,Blue) in C,H,L,B
0199   01F2             ramdac_set_palette_color:
0200   01F2 F5           	PUSH	AF		; STORE REGISTERS
0201   01F3 79          	LD 	A,C
0202   01F4 D3 98       	OUT	(ramdac_address_wr),A
0203   01F6 7C          	LD 	A,H
0204   01F7 D3 99       	OUT	(ramdac_palette_ram),A
0205   01F9 7D          	LD 	A,L
0206   01FA D3 99       	OUT	(ramdac_palette_ram),A
0207   01FC 78          	LD 	A,B
0208   01FD D3 99       	OUT	(ramdac_palette_ram),A
0209   01FF F1          	POP	AF		; RESTORE
0210   0200 C9          	RET
0211   0201             
0212   0201             ; parameter enable/blank the screen 1/0  in A
0213   0201             gdc_init:
0214   0201 F5          	PUSH 	AF
0215   0202             	; ********* RESET
0216   0202 3E 00       	LD	A,RESET		; DO RESET
0217   0204 CD 88 03    	CALL	OUTA		; SEND COMMAND
0218   0207 CD 6C 04    	CALL	PRINTCRLF
0219   020A             	; ********* SYNC
0220   020A F1          	POP 	AF
0221   020B F6 0E       	OR	SYNC		; DO SYNC (0x0E if blanked 0x0F if enabled)
0222   020D CD 88 03    	CALL	OUTA		; SEND COMMAND
0223   0210 0E 08       	LD	C,8		; NUMBER PARMS
0224   0212 21 3A 01    	LD	HL,SYNCP	; PARM TABLE
0225   0215 CD AE 03    	CALL	OUTC		; SEND PARMS
0226   0218 CD 6C 04    	CALL	PRINTCRLF
0227   021B             	; ********* VSYNC
0228   021B 3E 6F       	LD	A,VSYNC		; DO VSYNC
0229   021D CD 88 03    	CALL	OUTA		; SEND COMMAND
0230   0220 CD 6C 04    	CALL	PRINTCRLF
0231   0223             	; ********* PITCH
0232   0223 3E 47             	LD	A,PITCH		; DO PITCH
0233   0225 CD 88 03    	CALL	OUTA		; SEND COMMAND
0234   0228 21 45 01    	LD	HL,PITCHP	; PARM TABLE
0235   022B 0E 01       	LD	C,01H		; NUMBER PARAMS
0236   022D CD AE 03    	CALL	OUTC
0237   0230 CD 6C 04    	CALL	PRINTCRLF
0238   0233             	; ********* PRAM 1
0239   0233 21 46 01    	LD	HL,PRAMP	; PARM TABLE
0240   0236 0E 07       	LD	C,7		; NUMBER PARAMS
0241   0238 3E 00       	LD 	A,0		; START ADDRESS
0242   023A CD A4 02        	CALL	gdc_pram	; graphic area 1
0243   023D CD 6C 04    	CALL	PRINTCRLF
0244   0240             	; ********* PRAM 2
0245   0240 21 46 01        	LD	HL,PRAMP	; PARM TABLE
0246   0243 0E 07       	LD	C,7		; NUMBER PARAMS
0247   0245 3E 07       	LD 	A,7		; START ADDRESS
0248   0247 CD A4 02        	CALL	gdc_pram	; graphic area 2
0249   024A CD 6C 04    	CALL	PRINTCRLF
0250   024D             	; ********* PATTERN
0251   024D 21 51 01        	LD	HL,PATTERN	; PARM TABLE
0252   0250 0E 02       	LD	C,2		; NUMBER PARAMS
0253   0252 3E 08       	LD 	A,8		; START ADDRESS
0254   0254 CD A4 02        	CALL	gdc_pram	; graphic area 2
0255   0257 CD 6C 04    	CALL	PRINTCRLF
0256   025A             	; ********* ZOOM DISPLAY (FACTOR 1)
0257   025A 3E 00       	LD 	A,0
0258   025C CD 99 02    	CALL 	gdc_zoom_display
0259   025F CD 6C 04    	CALL	PRINTCRLF
0260   0262             	; ********* SET CURSOR
0261   0262 21 00 00    	LD 	HL,0000H
0262   0265 3E 00       	LD 	A,0H
0263   0267 CD 86 02    	CALL 	gdc_setcursor
0264   026A CD 6C 04    	CALL	PRINTCRLF
0265   026D             	; ********* SET MODE
0266   026D 3E 00       	LD 	A,GDC_REPLACE
0267   026F CD 7E 02    	CALL 	gdc_mode
0268   0272 CD 6C 04    	CALL	PRINTCRLF
0269   0275             	; ********* START
0270   0275 3E 6B             	LD	A,START		; DO START
0271   0277 CD 88 03    	CALL	OUTA		; SEND COMMAND
0272   027A CD 6C 04    	CALL	PRINTCRLF
0273   027D C9          	RET
0274   027E             
0275   027E             ; parameter (mode) in a
0276   027E             gdc_mode:
0277   027E E6 03       	AND 	3
0278   0280 F6 20       	OR 	20H
0279   0282 CD 88 03    	CALL	OUTA
0280   0285 C9          	RET
0281   0286             
0282   0286             
0283   0286             ; parameter (StartAddress) in AHL (AAHHLL)
0284   0286             gdc_setcursor:
0285   0286 F5          	PUSH 	AF
0286   0287 3E 49             	LD	A,CURS		; DO CURS
0287   0289 CD 88 03    	CALL	OUTA		; SEND COMMAND
0288   028C 7D          	LD 	A,L
0289   028D CD 9C 03    	CALL	OUTP		; SEND PARM
0290   0290 7C          	LD 	A,H
0291   0291 CD 9C 03    	CALL	OUTP		; SEND PARM
0292   0294 F1          	POP 	AF
0293   0295 CD 9C 03    	CALL	OUTP		; SEND PARM
0294   0298 C9          	RET
0295   0299             
0296   0299             ; parameter (factor) in A
0297   0299             gdc_zoom_display:
0298   0299 F5          	PUSH 	AF
0299   029A 3E 46           	LD 	A,46H
0300   029C CD 88 03        	CALL	OUTA		; SEND COMMAND
0301   029F F1          	POP 	AF
0302   02A0 CD 9C 03    	CALL	OUTP		; SEND PARM
0303   02A3 C9          	RET
0304   02A4             
0305   02A4             ; parameter (start,pointer to param,count) in A,HL,C
0306   02A4             gdc_pram:
0307   02A4 E6 0F       	AND 	0FH
0308   02A6 F6 70       	OR 	PRAM
0309   02A8 CD 88 03    	CALL	OUTA		; SEND COMMAND
0310   02AB CD AE 03    	CALL	OUTC
0311   02AE C9          	RET
0312   02AF             
0313   02AF             INIT7220:
0314   02AF             	; ********* RESET
0315   02AF 3E 00       	LD	A,RESET		; DO RESET
0316   02B1 CD 88 03    	CALL	OUTA		; SEND COMMAND
0317   02B4             	; ********* SYNC
0318   02B4 3E 0E       	LD	A,SYNC		; DO SYNC
0319   02B6 CD 88 03    	CALL	OUTA		; SEND COMMAND
0320   02B9 0E 08       	LD	C,8		; NUMBER PARMS
0321   02BB 21 3A 01    	LD	HL,SYNCP	; PARM TABLE
0322   02BE CD AE 03    	CALL	OUTC		; SEND PARMS
0323   02C1             	; ********* VSYNC
0324   02C1 3E 6F       	LD	A,VSYNC		; DO VSYNC
0325   02C3 CD 88 03    	CALL	OUTA		; SEND COMMAND
0326   02C6             	; ********* CCHAR
0327   02C6 3E 4B             	LD	A,CCHAR		; DO CCHAR
0328   02C8 CD 88 03    	CALL	OUTA		; SEND COMMAND
0329   02CB 21 42 01    	LD	HL,CCHARP	; PARM TABLE
0330   02CE 0E 03       	LD	C,03H		; NUMBER PARAMS
0331   02D0 CD AE 03    	CALL	OUTC
0332   02D3             	; ********* PITCH
0333   02D3 3E 47             	LD	A,PITCH		; DO PITCH
0334   02D5 CD 88 03    	CALL	OUTA		; SEND COMMAND
0335   02D8 21 45 01    	LD	HL,PITCHP	; PARM TABLE
0336   02DB 0E 01       	LD	C,01H		; NUMBER PARAMS
0337   02DD CD AE 03    	CALL	OUTC
0338   02E0             	; ********* PRAM
0339   02E0 3E 70             	LD	A,PRAM		; DO PRAM
0340   02E2 CD 88 03    	CALL	OUTA		; SEND COMMAND
0341   02E5 21 46 01    	LD	HL,PRAMP	; PARM TABLE
0342   02E8 0E 10       	LD	C,10H		; NUMBER PARAMS
0343   02EA CD AE 03    	CALL	OUTC
0344   02ED             	; ********* ZOOM
0345   02ED 3E 46             	LD	A,ZOOM		; DO ZOOM
0346   02EF CD 88 03    	CALL	OUTA		; SEND COMMAND
0347   02F2 21 4D 01    	LD	HL,ZOOMP	; PARM TABLE
0348   02F5 0E 01       	LD	C,01H		; NUMBER PARAMS
0349   02F7 CD AE 03    	CALL	OUTC
0350   02FA             	; ********* CURS
0351   02FA 3E 49             	LD	A,CURS		; DO CURS
0352   02FC CD 88 03    	CALL	OUTA		; SEND COMMAND
0353   02FF 21 4E 01    	LD	HL,CURSP	; PARM TABLE
0354   0302 0E 03       	LD	C,03H		; NUMBER PARAMS
0355   0304 CD AE 03    	CALL	OUTC
0356   0307             	; ********* START
0357   0307 3E 6B             	LD	A,START		; DO START
0358   0309 CD 88 03    	CALL	OUTA		; SEND COMMAND
0359   030C             
0360   030C C9          	RET
0361   030D             
0362   030D             gchar_test:
0363   030D             
0364   030D             ;  	 x x x x x x x x
0365   030D             ;        x     x x x x x
0366   030D             ;        x         x x x
0367   030D             ;        x       x   x x
0368   030D             ;        x     x     x x
0369   030D             ;        x   x       x x
0370   030D             ;        x           x x
0371   030D             ;        x x x x x x x x
0372   030D             
0373   030D             
0374   030D             	; ********* ZOOM  	gdc_zoom_draw(2);
0375   030D 3E 46             	LD	A,ZOOM		; DO ZOOM
0376   030F CD 88 03    	CALL	OUTA		; SEND COMMAND
0377   0312 3E 01       	LD	A,1
0378   0314 CD 9C 03    	CALL	OUTP
0379   0317 CD 6C 04    	CALL	PRINTCRLF
0380   031A             
0381   031A 21 53 01        	LD	HL,CHPATTERN	; PARM TABLE
0382   031D 0E 08       	LD	C,8		; NUMBER PARAMS
0383   031F 3E 08       	LD 	A,8		; START ADDRESS
0384   0321 CD A4 02        	CALL	gdc_pram	; graphic area 2
0385   0324 CD 6C 04    	CALL	PRINTCRLF
0386   0327             
0387   0327 3E 49             	LD	A,CURS		; DO CURS
0388   0329 CD 88 03    	CALL	OUTA		; SEND COMMAND
0389   032C 3E 64       	LD	A,100
0390   032E CD 9C 03    	CALL 	OUTP
0391   0331 3E 01       	LD	A,1
0392   0333 CD 9C 03    	CALL 	OUTP
0393   0336 3E 0A       	LD	A,10
0394   0338 CD 9C 03    	CALL 	OUTP
0395   033B CD 6C 04    	CALL	PRINTCRLF
0396   033E             
0397   033E             	; ********* SET MODE
0398   033E 3E 00       	LD 	A,GDC_REPLACE
0399   0340 CD 7E 02    	CALL 	gdc_mode
0400   0343 CD 6C 04    	CALL	PRINTCRLF
0401   0346             
0402   0346             
0403   0346 3E 4C             	LD	A,04CH		; DO FIGS
0404   0348 CD 88 03    	CALL	OUTA		; SEND COMMAND
0405   034B 3E 10       	LD	A,10H
0406   034D CD 9C 03    	CALL 	OUTP
0407   0350 3E 07       	LD	A,7
0408   0352 0E 00       	LD	C,0
0409   0354 CD 7E 03            CALL	gdc_Dparam	; perp. pix - 1
0410   0357 3E 08       	LD	A,8
0411   0359 0E 00       	LD	C,0
0412   035B CD 7E 03            CALL 	gdc_Dparam	; initial dir pix
0413   035E 3E 08       	LD	A,8
0414   0360 0E 00       	LD	C,0
0415   0362 CD 7E 03            CALL 	gdc_Dparam
0416   0365 CD 6C 04    	CALL	PRINTCRLF
0417   0368             
0418   0368 3E 68             	LD	A,068H		; DO GCHRD
0419   036A CD 88 03    	CALL	OUTA		; SEND COMMAND
0420   036D CD 6C 04    	CALL	PRINTCRLF
0421   0370             
0422   0370               	; ********* ZOOM  	gdc_zoom_draw(1);
0423   0370 3E 46             	LD	A,ZOOM		; DO ZOOM
0424   0372 CD 88 03    	CALL	OUTA		; SEND COMMAND
0425   0375 3E 01       	LD	A,1
0426   0377 CD 9C 03    	CALL	OUTP
0427   037A CD 6C 04    	CALL	PRINTCRLF
0428   037D             
0429   037D             	; ********* START
0430   037D             ;      	LD	A,START		; DO START
0431   037D             ;	CALL	OUTA		; SEND COMMAND
0432   037D             ;	CALL	PRINTCRLF
0433   037D C9          	RET
0434   037E             
0435   037E             ; parameter (d,or) in A,C
0436   037E             gdc_Dparam:
0437   037E F5          	PUSH 	AF
0438   037F CD 9C 03    	CALL 	OUTP
0439   0382 F1          	POP 	AF
0440   0383             
0441   0383             ;	AND 	03FH
0442   0383             ;	OR 	C
0443   0383 79          	LD 	A,C
0444   0384 CD 9C 03    	CALL 	OUTP
0445   0387 C9          	RET
0446   0388             
0447   0388             OUTA:
0448   0388 E5          	PUSH 	HL
0449   0389 F5           	PUSH	AF		; STORE REGISTERS
0450   038A             OUTALOOP:
0451   038A DB 90       	IN	A,(gdc_status) 	; READ STATUS
0452   038C E6 0A       	AND	00001010B	; IS READY?
0453   038E C2 8A 03    	JP	NZ,OUTALOOP	; NO, LOOP
0454   0391 F1          	POP	AF		; YES, RESTORE GDC COMMAND
0455   0392 D3 91       	OUT	(gdc_command),A	; FIFO GDC command
0456   0394 CD 33 04    	call 	HXOUT
0457   0397 CD 5C 04    	call 	PRINTC
0458   039A E1          	POP 	HL
0459   039B C9          	RET
0460   039C             
0461   039C             
0462   039C             OUTP:
0463   039C F5           	PUSH	AF		; STORE REGISTERS
0464   039D             OUTPLOOP:
0465   039D DB 90       	IN	A,(gdc_status) 	; READ STATUS
0466   039F E6 0A       	AND	00001010B	; IS READY?
0467   03A1 C2 9D 03    	JP	NZ,OUTPLOOP	; NO, LOOP
0468   03A4 F1          	POP	AF		; YES, RESTORE GDC PARAMETER
0469   03A5 D3 90       	OUT	(gdc_param),A	; FIFO GDC PARAMETER
0470   03A7 CD 33 04    	call 	HXOUT
0471   03AA CD 64 04    	call 	PRINTP
0472   03AD C9          	RET
0473   03AE             
0474   03AE             
0475   03AE             OUTC:
0476   03AE DB 90         	IN	A,(gdc_status)	; READ STATUS
0477   03B0 E6 0A       	AND	00001010B  	; IS READY?
0478   03B2 C2 AE 03    	JP	NZ,OUTC		; NO,LOOP
0479   03B5 7E          	LD	A,(HL)		; GET GDC PARM
0480   03B6             
0481   03B6 E5          	PUSH 	HL
0482   03B7 CD 33 04    	call 	HXOUT
0483   03BA CD 64 04    	call 	PRINTP
0484   03BD E1          	POP 	HL
0485   03BE             
0486   03BE D3 90       	OUT	(gdc_param),A	; WRITE PARM TO GDC
0487   03C0 23          	INC	HL		; NEXT PARM
0488   03C1 0D          	DEC	C		; DEC COUNTER
0489   03C2 C2 AE 03    	JP	NZ,OUTC		; IF NOT DONE, LOOP
0490   03C5 C9          	RET			;
0491   03C6             
0492   03C6             
0493   03C6             MSG_START:
0494   03C6 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0495   03C8 53 54 41 52 	.TEXT	  "START 7220 TEST PROGRAM"
0495   03CC 54 20 37 32 
0495   03D0 32 30 20 54 
0495   03D4 45 53 54 20 
0495   03D8 50 52 4F 47 
0495   03DC 52 41 4D 
0496   03DF 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0497   03E1 24          	.DB	    END 				      ; LINE TERMINATOR
0498   03E2             
0499   03E2             MSG_END:
0500   03E2 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0501   03E4 45 4E 44 20 	.TEXT	  "END 7220 TEST PROGRAM"
0501   03E8 37 32 32 30 
0501   03EC 20 54 45 53 
0501   03F0 54 20 50 52 
0501   03F4 4F 47 52 41 
0501   03F8 4D 
0502   03F9 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0503   03FB 24          	.DB	    END 				      ; LINE TERMINATOR
0504   03FC             
0505   03FC             MSG_INIT:
0506   03FC 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0507   03FE 37 32 32 30 	.TEXT	  "7220 INIT COMPLETED"
0507   0402 20 49 4E 49 
0507   0406 54 20 43 4F 
0507   040A 4D 50 4C 45 
0507   040E 54 45 44 
0508   0411 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0509   0413 24          	.DB	    END 				      ; LINE TERMINATOR
0510   0414             
0511   0414             
0512   0414             MSG_GCHAR:
0513   0414 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0514   0416 37 32 32 30 	.TEXT	  "7220 GCHAR TEST"
0514   041A 20 47 43 48 
0514   041E 41 52 20 54 
0514   0422 45 53 54 
0515   0425 0A 0D       	.DB	    LF, CR				      ; LINE FEED AND CARRIAGE RETURN
0516   0427 24          	.DB	    END 				      ; LINE TERMINATOR
0517   0428             
0518   0428             
0519   0428             
0520   0428             ;________________________________________________________________________________________________________________________________
0521   0428             ;
0522   0428             COUT:
0523   0428 C5          	PUSH   BC			; STORE AF
0524   0429 D5          	PUSH   DE
0525   042A 5F          	LD 	E,A
0526   042B 0E 02       	LD	C,02H		;
0527   042D CD 05 00    	CALL	0005H 		;
0528   0430 D1          	POP 	DE
0529   0431 C1          	POP	BC			; RESTORE AF
0530   0432 C9          	RET				; DONE
0531   0433             
0532   0433             HXOUT:
0533   0433 F5          	push    af
0534   0434 C5          	PUSH	BC			; SAVE BC
0535   0435 47          	LD	B,A			;
0536   0436 CB 07       	RLC	A			; DO HIGH NIBBLE FIRST
0537   0438 CB 07       	RLC	A			;
0538   043A CB 07       	RLC	A			;
0539   043C CB 07       	RLC	A			;
0540   043E E6 0F       	AND	0FH			; ONLY THIS NOW
0541   0440 C6 30       	ADD	A,30H			; TRY A NUMBER
0542   0442 FE 3A       	CP	3AH			; TEST IT
0543   0444 38 02       	JR	C,OUT1			; IF CY SET PRINT 'NUMBER'
0544   0446 C6 07       	ADD	A,07H			; MAKE IT AN ALPHA
0545   0448             OUT1:
0546   0448 CD 28 04    	CALL	COUT			; SCREEN IT
0547   044B 78          	LD	A,B			; NEXT NIBBLE
0548   044C E6 0F       	AND	0FH			; JUST THIS
0549   044E C6 30       	ADD	A,30H			; TRY A NUMBER
0550   0450 FE 3A       	CP	3AH			; TEST IT
0551   0452 38 02       	JR	C,OUT2			; PRINT 'NUMBER'
0552   0454 C6 07       	ADD	A,07H			; MAKE IT ALPHA
0553   0456             OUT2:
0554   0456 CD 28 04    	CALL	COUT			; SCREEN IT
0555   0459 C1          	POP	BC			; RESTORE BC
0556   045A F1          	pop   	af
0557   045B C9          	RET				;
0558   045C             
0559   045C             
0560   045C             PRINTC:
0561   045C F5          	PUSH	AF			; STORE AF
0562   045D 3E 3A       	LD	A,':'			;
0563   045F CD 28 04    	CALL	COUT			; SCREEN IT
0564   0462 F1          	POP	AF			; RESTORE AF
0565   0463 C9          	RET				; DONE
0566   0464             PRINTP:
0567   0464 F5          	PUSH	AF			; STORE AF
0568   0465 3E 20       	LD	A,' '			;
0569   0467 CD 28 04    	CALL	COUT			; SCREEN IT
0570   046A F1          	POP	AF			; RESTORE AF
0571   046B C9          	RET
0572   046C             
0573   046C             PRINTCRLF:
0574   046C F5          	PUSH	AF			; STORE AF
0575   046D 3E 0A       	LD	A,10			;
0576   046F CD 28 04    	CALL	COUT			; SCREEN IT
0577   0472 3E 0D       	LD	A,13			;
0578   0474 CD 28 04    	CALL	COUT			; SCREEN IT
0579   0477             
0580   0477 F1          	POP	AF			; RESTORE AF
0581   0478 C9          	RET
0582   0479             
0583   0479             
0584   0479             
0585   0479             
0586   0479             
0587   0479             
0588   0479             
0589   0479             
0590   0479             
0591   0479             
0592   0479             
0593   0479             
0594   0479             
0595   0479             
0596   0479             
0597   0479             
0598   0479             .END
